Backplane README
================

This Backplane Server implements both the [Backplane v2.0] [2] and the previous
[Backplane v1.2] [1] specifications.

Specifics for each of the Backplane versions are described in the following README files:

* [README12.md] [4]

* [README20.md] [5]


The deployment environment is Amazon AWS / Beanstalk and the storage engine used is SimpleDB.

Administrative accounts and configuration data described in this document is provisioned manually,
e.g. using the [SimpleDB Shell] [6] tool.

AWS Environment Configuration
-----------------------------

Each Backplane Server logical instance (hosted on AWS) is identified by its *instance ID*.

The Backplane Server learns its bootstrap configuration parameters from the following environment variables:

* `PARAM1`: The logical Backplane **instance ID**. Used to identify configuration data sets within SimpleDB
and allow multiple (AWS) instances to be part of the same logical Backplane Server deployment.

* `AWS_ACCESS_KEY_ID`: Key ID for accessing SimpleDB.

* `AWS_SECRET_KEY`: Secret key for accessing SimpleDB.

* `PARAM2`: Reporting domain for emails sent from Backplane server via log4j's SMTPAppender
(e.g., "samplebackplane.com").  Emails have a complete origin format of `${PARAM1}@${PARAM2}`.

* `PARAM3`: Destination for log4j email notifications (e.g., "backplane-email@homedomain.com").

Backplane Server Configuration
------------------------------

Server configuration data must defined in a SimpleDB table named **`<instance ID>_bpserverconfig`**.

* `DEBUG_MODE`: boolean flag for debug logging and behavior

* `CONFIG_CACHE_AGE_SECONDS`: how long to keep this server configuration data in a memory cache

* `CLEANUP_INTERVAL_MINUTES`: how often to run a thread for cleaning up expired items,
such as messages, tokens, sessions, etc.

* `DEFAULT_MESSAGES_MAX`: the default maximum number of messages in a Backplane channel,
if not explicitly configured for the channel's bus


Administrator Authentication
----------------------------

Administrators can access the Bus Provisioning API and update Bus Configuration data.
Administrator credentials are kept in the `<backplane-instance>_Admin` table:

* `USER`: admin username

* `PWDHASH`: admin password (hash)

To retrieve the generated metrics, you must add the `<backplane-instance>_bpMetricAuth` table:

* `USER`: metrics username

* `PWDHASH`: metrics password (hash)

To generate a password hash, see the HmacHashUtils class and its main() method.

For convenience a JAR file (and associated dependencies) are availabe under `/extra/hashutil/`
and password hashes can be generated by invoking:

        java -jar hashutil.jar


Building From Source
--------------------

This project requires the [Maven] [3] build tool.

        mvn package -DskipTests=true

To process the tests, you must have created an Amazon SimpleDB instance.
Use the following modification to the Maven build command (be sure to add your parameters):

        mvn package -DargLine="-DPARAM1=instanceid -DPARAM2=sample.com -DPARAM3=backplane-email@sample.com -DAWS_ACCESS_KEY_ID=key -DAWS_SECRET_KEY=secret"

Maven will create a WAR file for deployment in the `/target/` directory.


[1]: http://sites.google.com/site/backplanespec/documentation/backplane1-2
[2]: http://sites.google.com/site/backplanespec/documentation/backplane2-0-draft08
[3]: http://maven.apache.org/guides/getting-started/maven-in-five-minutes.html
[4]: http://github.com/janrain/janrain-backplane-2/blob/master/README12.md "Backplane v1.2"
[5]: http://github.com/janrain/janrain-backplane-2/blob/master/README12.md "Backplane v2.0"
[6]: http://typica.googlecode.com/files/sdbShell.jar

